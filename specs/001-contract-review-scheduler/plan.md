# 契約審查預約系統 - 實作計畫

**功能分支**: `001-contract-review-scheduler`  
**建立日期**: 2025-11-18  
**狀態**: 規劃中

## 技術背景

### 選定技術棧
- **前端框架**: React + TypeScript
- **後端框架**: Node.js + Express.js
- **資料庫**: PostgreSQL
- **驗證**: Active Directory (WiAD) 整合
- **郵件服務**: SMTP (公司郵件系統)
- **前端狀態管理**: Redux Toolkit
- **UI 框架**: Material-UI (支援繁體中文)
- **API 風格**: RESTful API

### 依賴項目
- WiAD 帳號系統 API 文件
- 公司郵件 SMTP 伺服器設定
- 公司網路基礎設施

## 憲章檢查 (Constitution Check)

### 適用原則

✅ **I. 代碼品質標準**
- 最大循環複雜度: 10
- 最小程式碼涵蓋率: 80%
- 所有公開 API 需要文件和示例
- 遵循 SOLID 原則

✅ **II. 測試卓越性**
- 實施 TDD 方法
- 單元測試所有業務邏輯
- 整合測試服務介面
- 端到端測試關鍵使用者流程

✅ **III. 使用者體驗一致性**
- 所有使用者介面必須使用繁體中文 (zh-TW)
- 響應式設計
- WCAG 2.1 AA 無障礙合規
- 統一錯誤處理和訊息

✅ **IV. 性能要求**
- 頁面載入時間 < 2 秒
- API 回應時間 (95th percentile) < 200ms
- 客戶端渲染 < 100ms

✅ **V. 安全標準**
- 安全的身份驗證和授權
- 定期安全稽核
- 輸入驗證和防衛
- OWASP Top 10 保護

✅ **VI. 文件語言標準**
- 所有規格和技術文件必須使用繁體中文
- API 文件使用繁體中文
- 錯誤訊息使用繁體中文
- 程式碼註釋使用繁體中文

## Phase 0: 研究與釐清

### 研究任務

#### 1. WiAD 整合
**狀態**: ✅ 完成
- 決策：使用 LDAP 協議整合 AD
- 工具：ldapjs npm 套件
- 詳見 `research.md`

#### 2. 郵件系統整合
**狀態**: ✅ 完成
- 決策：使用 Nodemailer + SMTP
- 工具：Nodemailer, bull (佇列管理)
- 詳見 `research.md`

#### 3. 月曆 UI 元件
**狀態**: ✅ 完成
- 決策：React Big Calendar
- 自訂時段和預約顯示
- 詳見 `research.md`

#### 4. 時段衝突檢測演算法
**狀態**: ✅ 完成
- 決策：雙層驗證（資料庫 + 應用層）
- PostgreSQL 範圍查詢
- 詳見 `research.md`

### 研究輸出
✅ `research.md` - 包含 10 個主要技術決策和理由

## Phase 1: 設計與約定

### 1. 資料模型
**狀態**: ✅ 完成
**檔案**: `data-model.md`
**內容**:
- 5 個核心實體定義 (User, Appointment, LeaveSchedule, AppointmentHistory, NotificationLog)
- 完整的欄位、型別、約束說明
- 狀態轉換圖
- 資料庫初始化 SQL 指令
- 效能最佳化策略
- 快取策略

### 2. API 契約
**狀態**: ✅ 完成
**檔案**: `contracts/openapi.yaml`
**內容**:
- OpenAPI 3.0 規範
- 11 個主要端點定義
- 認證、月曆、預約、休假 4 個主題分類
- 完整的請求/回應範例
- 5 個核心資料結構定義

### 3. 快速開始指南
**狀態**: ✅ 完成
**檔案**: `quickstart.md`
**內容**:
- 環境設置 (Docker Compose 和本機)
- 專案結構說明
- 常用命令參考
- 常見問題解答
- 部署準備指南
- 憲章合規性檢查清單

## Phase 2: 任務分解

### 待分解領域

1. **後端基礎設施**
   - 專案初始化和依賴設定
   - 資料庫架構和遷移
   - WiAD 認證整合
   - 郵件服務設定

2. **預約核心功能**
   - 預約 CRUD 操作
   - 時段衝突驗證
   - 休假檢查邏輯
   - 預約狀態轉換

3. **審查人員功能**
   - 預約接受/拒絕
   - 休假管理
   - 預約轉送代理

4. **前端使用者介面**
   - 登入頁面
   - 月曆檢視
   - 預約表單
   - 預約確認對話
   - 審查人員管理面板

5. **郵件通知系統**
   - 通知範本
   - 郵件佇列服務
   - 通知日誌記錄

6. **測試和品質保證**
   - 單元測試
   - 整合測試
   - 端到端測試
   - 效能測試

## 門檻檢查

- ✅ 規格已釐清 (5 個關鍵決策已解決)
- ✅ 研究已完成 (10 個技術決策已定義)
- ✅ 資料模型設計完成 (5 個實體完整定義)
- ✅ API 契約已定義 (OpenAPI 3.0 規範)
- ✅ 開發指南已完成 (快速開始指南)
- ✅ 憲章檢查通過 (所有 6 項原則都已遵循)

## 後續步驟

1. ✅ Phase 0 研究完成 → `research.md`
2. ✅ Phase 1 設計完成 → `data-model.md`, `contracts/`, `quickstart.md`
3. ⏳ Phase 2: 進行任務分解 → 產出 `tasks.md`

## 已產出檔案清單

| 檔案名 | 用途 | 狀態 |
|--------|------|------|
| `spec.md` | 功能規格 | ✅ 完成 |
| `plan.md` | 實作計畫 (本檔案) | ✅ 完成 |
| `research.md` | 技術決策研究 | ✅ 完成 |
| `data-model.md` | 資料庫設計 | ✅ 完成 |
| `contracts/openapi.yaml` | API 規範 | ✅ 完成 |
| `quickstart.md` | 開發指南 | ✅ 完成 |
| `tasks.md` | 任務分解 | ⏳ 待產出 |
| `checklists/requirements.md` | 規格檢查清單 | ✅ 完成 |